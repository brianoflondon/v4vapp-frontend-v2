# StatusPage.vue — Build Documentation

## Overview

The status page (`src/pages/StatusPage.vue`) displays live gateway status, fees, rate limits, and conversion examples for the V4V.app Hive-to-Lightning bridge. It replaced a static "under construction" placeholder with a fully dynamic page.

Previously, the status page content was generated by a Python script and published as a Markdown post on Hive (see `src/assets/status_page.md` for the old output and `src/assets/status_page_template.md` for the template). This Vue page replicates that functionality entirely in the frontend.

## Data Sources

The page pulls data from two independent sources on mount:

### 1. Hive Blockchain — `v4vapp_hiveconfig`

Fetched via `useHiveDetails(serverHiveAccount)` which calls `condenser_api.get_accounts` on the Hive node (`api.deathwing.me`). The config is stored in the `posting_json_metadata` field of the `v4vapp` (or `devser.v4vapp` in dev) account under the key `v4vapp_hiveconfig`.

**Fields used from `v4vapp_hiveconfig`:**

| Field | Usage |
|---|---|
| `closed_get_lnd` | Gateway status chip (Hive → Lightning) |
| `closed_get_hive` | Gateway status chip (Lightning → Hive) |
| `conv_fee_sats` | Flat conversion fee in sats |
| `conv_fee_percent` | Percentage conversion fee |
| `lightning_rate_limits` | Array of `{hours, sats}` per-user rate limits |

### 2. V4V.app API — `storeAPIStatus`

The Pinia store `storeAPIStatus` fetches from `https://api.v4v.app/v1?get_crypto=true`. This is normally refreshed every 10 minutes by `PriceBar.vue`, but the StatusPage forces an immediate `storeAPI.update()` on mount to ensure fresh data.

**Getters used from the store:**

| Getter | Usage |
|---|---|
| `hiveSatsNumber` | Hive price in sats (for sats↔Hive conversion) |
| `HBDSatsNumber` | HBD price in sats (for sats↔HBD conversion) |
| `minMax` | Min/max invoice amounts in sats, HIVE, HBD, USD |
| `apiStatus` | Guards the fees section (only renders when data is available) |

## Page Sections

### Header Card
- App name, version (from `useAppDetails` / `package.json`)
- Link to v4vapp-v2 development posts on PeakD
- V4V.app logo linking to the fees post on Hive

### Gateway Status
- Two `q-chip` components showing OPEN (green) or CLOSED (red) for each direction
- Driven by `closed_get_lnd` and `closed_get_hive` booleans from the blockchain config

### Current Fees Table
- **Conversion fee (flat):** `conv_fee_sats` from blockchain, converted to Hive/HBD using live rates
- **Conversion fee (percentage):** `conv_fee_percent` from blockchain, displayed as percentage
- **Min/Max invoice:** From `storeAPI.minMax` (computed by the API from the same blockchain config + live prices)

### Rate Limits Table
- Iterates `lightning_rate_limits` array from blockchain config
- Each row: period (hours), sats limit, equivalent in Hive and HBD (computed via `hiveSatsNumber` / `HBDSatsNumber`)

### HBD to Sats Examples
- Fixed HBD amounts: 1, 2, 5, 10, 20, 50
- Net sats computed as: `(hbd * HBDSatsNumber - conv_fee_sats) * (1 - conv_fee_percent)`

### Notes
- Static HTML strings rendered via `v-html` on plain `<div>` elements (not on Quasar components, to avoid the "v-html on component" lint warning)
- Content matches the original status page markdown notes

## Computed Properties

| Property | Formula |
|---|---|
| `currentUTCTime` | Formatted as `HH:mm D Mon YYYY` in UTC |
| `convFeeHive` | `conv_fee_sats / hiveSatsNumber` |
| `convFeeHBD` | `conv_fee_sats / HBDSatsNumber` |
| `rateLimits` | Maps each `{hours, sats}` → adds `hive` and `hbd` equivalents |
| `hbdExamples` | For each HBD amount, computes net sats after flat + percentage fees |

## Key Dependencies

- `useHiveDetails()` from `src/use/useHive.js` — Hive blockchain RPC call
- `useStoreAPIStatus` from `src/stores/storeAPIStatus.js` — Pinia store with live prices
- `tidyNumber()` from `src/use/useUtils.js` — Number formatting with comma separators
- `useAppDetails()` from `src/use/useAppDetails.js` — App name/version from `package.json`
- `serverHiveAccount` from `boot/axios.js` — `"v4vapp"` in prod, `"devser.v4vapp"` in dev

## Debug Logging

On every page load, the raw `posting_json_metadata` and extracted `v4vapp_hiveconfig` are logged to the browser console via `console.debug()` for troubleshooting stale data.

## History

- **Initial build:** Replaced static "under construction" placeholder with dynamic fee tables
- **Removed:** Proposal support links (PeakD, Hivesigner, Ecency), Vote for Witness link, and VoteProposal component
- **Added:** Forced `storeAPI.update()` on mount to prevent stale cached data from localStorage persistence
- **Added:** `console.debug` logging of raw blockchain config for debugging
